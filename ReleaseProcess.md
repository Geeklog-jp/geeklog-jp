# リリースの手順 #

本ドキュメントでは、リリースを行う手順について説明します。

## 準備 ##

リリースを行うためには、以下のことを確認しておく必要があります。

  * リリースを行う元とするソースツリーがGeeklogのインストールや動作が十分に確認できていること。
  * リリース作業に開発者間で同意が取れていること。

## リリース作業 ##

以下はgeeklog-2.0-jp-1.0をリリースする場合を例にして、説明します。

  1. `GNUmakefile.common`の中の`GL_VERSION`の値を確認します。通常、オリジナルのGeeklogを取り込んだ段階で、そのリリース(この例では2.0)と合致しているはずです。
  1. `GNUmakefile.common`の中の`GL_JPVERSION`の値を日本語バージョンのリリースバージョンに設定します。
  1. `make update-release-jp`を実行して、`release_jp.php`の内容を更新します。
  1. `CHANGES.jp`にリリースするバージョンの記述を行います。
  1. ここまでの修正をコミットします。
  1. リリースのタグを作成します。これは、Mercurialのコマンド行ツールhgの場合は、次のように実行します。
```
    % hg tag geeklog-2.0-jp-1.0
```
  1. Mercurialのタグに対応するアーカイブをtar形式で作成します。
```
    % hg archive -r geeklog-2.0-jp-1.0 /var/tmp/geeklog-2.0-jp-1.0.tar
```
  1. 次に、リリースするファイルを取り出す作業用のディレクトリに移動します。
```
    % cd /var/tmp
```
  1. 移動したディレクトリで、tar形式のアーカイブのファイルを展開します。
```
    % tar -x -f geeklog-2.0-jp-1.0.tar
```
  1. tar形式のアーカイブのファイルの拡張子を除いたディレクトリ以下に展開されますので、そこに移動します。
```
    % cd geeklog-2.0-jp-1.0
```
  1. 日本語通常版の配布ファイルを以下のようにして作成します。
```
    % make release
```
  1. 日本語拡張版の配布ファイルは、makeのEXTENDEDのマクロを定義して以下のようにして作成します。
```
    % env EXTENDED= make release
```
  1. 以上が終了して，残しておく必要がなければexportしたファイルを削除します。
```
    % cd /var/tmp
    % rm -rf geeklog-2.0-jp-1.0
```